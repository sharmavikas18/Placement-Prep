name: Welcome First-Time Contributors

on:
  pull_request:
    types: [opened]

jobs:
  welcome-contributor:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Check if First-Time Contributor
        uses: actions/github-script@v7
        id: check-first-time
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            const author = pr.user.login;

            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              per_page: 100
            });

            const userPRs = prs.data.filter(p => p.user.login === author);
            const isFirstTime = userPRs.length === 1;

            core.setOutput('is-first-time', isFirstTime);
            core.setOutput('author', author);
            core.setOutput('pr-number', pr.number);

      - name: Welcome First-Time Contributor
        if: steps.check-first-time.outputs.is-first-time == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const author = '${{ steps.check-first-time.outputs.author }}';
            const prNumber = parseInt('${{ steps.check-first-time.outputs.pr-number }}');

            const welcomeMessage = [
              `## ğŸ‰ Welcome to Woc, @${author}!`,
              ``,
              `### ğŸŒŸ First-Time Contributor Badge`,
              `![First Time Contributor](https://img.shields.io/badge/First%20Time%20Contributor-DevElevate-brightgreen?style=for-the-badge&logo=github)`,
              ``,
              `ğŸŠ **Congratulations!** You've just made your first contribution to Placement Preparetion Hub !`,
              ``,
              `### ğŸ¯ What This Means`,
              `- You're part of our open-source community`,
              `- Your contribution helps students & developers worldwide`,
              `- You're contributing to a GSSoC 2025 project`,
              ``,
              `### ğŸš€ Next Steps`,
              `1. **Review Process**: Maintainers review your PR`,
              `2. **Feedback**: Apply suggested improvements`,
              `3. **Merge**: Once approved, your code will merge`,
              `4. **Celebrate**: Your contribution appears on your GitHub profile`,
              ``,
              `### ğŸ’¡ Tips for Success`,
              `- Respond promptly to review comments`,
              `- Keep PR focused and documented`,
              `- Ask questions in comments if needed`,
              `- Join [Discord]() for support`,
              ``,
              `### ğŸ† Recognition`,
              `- Added to contributors list`,
              `- Mentioned in release notes`,
              `- Eligible for GSSoC 2025`,
              ``,
              `---
              *Welcome to the Woc family! ğŸŒŸ*`
            ].join('\n');

            await github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: welcomeMessage
            });

      - name: Add First-Time Contributor Label
        if: steps.check-first-time.outputs.is-first-time == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prNumber = parseInt('${{ steps.check-first-time.outputs.pr-number }}');

            await github.rest.issues.addLabels({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['first-time-contributor', 'gssoc-2025']
            });
